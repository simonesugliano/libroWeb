<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>3D Page Flip â€“ Apertura/Chiusura Manuale Reale</title>

<style>
html,body {
  height:100%;
  overflow: hidden;
}
body {
  background: radial-gradient(#E4CEA6, #9C8763);
  perspective: 900px;
  margin: 0;
}

/* ===== FLIP ===== */
#flip {
  height: 350px;
  width: 253px; 
  position: absolute;
  left: 50%;
  top: 30%;
  transform: translateZ(-10px) rotateX(60deg) rotateZ(29deg) rotateY(0deg);
  transform-style: preserve-3d;
  transform-origin: 0 0 0;
}

/* Apertura e chiusura controllate */
#flip.open { animation: wrapper 4s ease-in-out forwards; }
#flip.close { animation: wrapperReverse 4s ease-in-out forwards; }

@keyframes wrapper {
  0% {
    transform: translateZ(-10px) rotateX(60deg) rotateZ(29deg) rotateY(0deg);
  }
  50%,100% {
    transform: translateZ(-10px) rotateX(60deg) rotateZ(29deg) rotateY(-165deg);
  }
}
@keyframes wrapperReverse {
  0% {
    transform: translateZ(-10px) rotateX(60deg) rotateZ(29deg) rotateY(-165deg);
  }
  100% {
    transform: translateZ(-10px) rotateX(60deg) rotateZ(29deg) rotateY(0deg);
  }
}

/* Pagine */
#flip div {
  height: 350px;
  width: 24px;
  position: absolute;
  left: calc(100% - 1px);
  transform-origin: 0 100%;
  transform-style: preserve-3d;
  background-size: 253px 350px;
}
#flip #front, 
#flip #front div {
  background-image: url(http://blogs.slj.com/afuse8production/files/2012/06/Hobbit1.jpg);
  box-shadow: inset rgba(255,255,255,0.3) 0px -1px 0 0,#35582C 0px 1px 0px 0px;
}
#flip #front > div > div > div > div > div > div > div > div > div > div { 
  box-shadow: inset rgba(255,255,255,0.3) -1px -1px 0 0, #35582C 1px 1px 0px 0px;
}
#flip #back { transform: rotateY(.4deg); transform-origin: -100% 0; }
#flip #back,
#flip #back div {
  background-image: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/164210/map1_.jpg); 
}

/* Curvatura pagine */
#flip > div { left: 0; background-position-x: 0; }
#flip div > div { background-position-x: -23px; }
#flip div > div > div { background-position-x : -46px; } 
#flip div > div > div > div { background-position-x : -69px; }
#flip div > div > div > div > div { background-position-x : -92px; }
#flip div > div > div > div > div > div { background-position-x : -115px; }
#flip div > div > div > div > div > div > div { background-position-x : -138px; }
#flip div > div > div > div > div > div > div > div  { background-position-x : -161px; }
#flip div > div > div > div > div > div > div > div > div { background-position-x : -184px; }
#flip div > div > div > div > div > div > div > div > div > div { background-position-x : -207px; }
#flip div > div > div > div > div > div > div > div > div > div > div { background-position-x : -229px; }

/* pagina piegata: attiva solo durante animazione */
#flip.open div > div,
#flip.close div > div {
  animation: page 4s ease-in-out;
  animation-fill-mode: forwards;
}

/* Curvatura piÃ¹ realistica e meno "svolazzante" */
@keyframes page {
  10% { transform: rotateY(-6deg); }
  40% { transform: rotateY(-3deg); }
  60% { transform: rotateY(6deg); }
  100% { transform: rotateY(0deg); }
}

/* ===== BOOK ===== */
#book {
  width: 248px;
  height: 350px;
  position: absolute;
  left:50%;
  top: 30%;
  transform: translate3d(0px,0px,-10px) rotateX(60deg) rotateZ(29deg);
  transform-style: preserve-3d;
  -webkit-transform-origin: 0 0 0;
}

#book.open #top { animation: book 4s ease-in-out forwards; }
#book.open #shadow { animation: shadow 4s ease-in-out forwards; }
#book.close #top { animation: bookReverse 4s ease-in-out forwards; }
#book.close #shadow { animation: shadowReverse 4s ease-in-out forwards; }

@keyframes book {
  0% { box-shadow: inset rgba(0,0,0,.2) 0px 0 50px -140px; }
  100% { box-shadow: inset rgba(0,0,0,.2) 420px 0 50px -140px; }
}
@keyframes bookReverse {
  0% { box-shadow: inset rgba(0,0,0,.2) 420px 0 50px -140px; }
  100% { box-shadow: inset rgba(0,0,0,.2) 0px 0 50px -140px; }
}

#book #top {
  background: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/164210/map2.jpg);
  background-size: 100% 100%;
  background-position: 100%;
  box-shadow: inset rgba(0,0,0,0.2) 420px 0 50px -140px;
  height: 350px;
  width: 248px;
  position: absolute;
  left: 0;
  top: 0;
}
#book #bottom {
  background: #E7DED1;
  box-shadow: rgba(83, 53, 13, 0.2) 4px 2px 1px, #35582C 1px 1px 0px 0px;
  height: 350px;
  width: 253px;
  position: absolute;
  transform: translateZ(-40px);
  left: 0;
  top: 0;
}
#book #shadow {
  box-shadow: inset rgba(83, 53, 13, 0.25) -300px 0 150px -140px;
  height: 350px;
  width: 248px;
  position: absolute;
  left: -100%;
  top: 0;
  transform: translateZ(-40px);
}

@keyframes shadow {
  0% { box-shadow: inset rgba(83, 53, 13, 0.1) -150px 0 150px -140px; }
  50% { box-shadow: inset rgba(83, 53, 13, 0.35) -280px 0 150px -140px; }
  100% { box-shadow: inset rgba(83, 53, 13, 0.35) -280px 0 150px -140px; }
}
@keyframes shadowReverse {
  0% { box-shadow: inset rgba(83, 53, 13, 0.35) -280px 0 150px -140px; }
  100% { box-shadow: inset rgba(83, 53, 13, 0.1) -150px 0 150px -140px; }
}

/* ===== BUTTON ===== */
button {
  position: absolute;
  top: 85%;
  left: 50%;
  transform: translateX(-50%);
  padding: 10px 25px;
  font-size: 18px;
  font-family: sans-serif;
  background: #4B3820;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
button:hover { background: #6a5234; }
</style>
</head>
<body>

<div id="book">
  <div id="top"></div>
  <div id="front"></div>
  <div id="right"></div>
  <div id="bottom"></div>
  <div id="shadow"></div>
</div>

<div id="flip">
  <div id="front">
    <div><div><div><div><div><div><div><div><div><div></div></div></div></div></div></div></div></div></div>
  </div>
  <div id="back">
    <div><div><div><div><div><div><div><div><div><div></div></div></div></div></div></div></div></div></div>
  </div>
</div>

<button id="toggleBtn">Apri Libro ðŸ“–</button>

<script>
const flip = document.getElementById('flip');
const book = document.getElementById('book');
const btn = document.getElementById('toggleBtn');
let isOpen = false;

btn.addEventListener('click', () => {
  flip.classList.remove('open', 'close');
  book.classList.remove('open', 'close');
  void flip.offsetWidth; // forza reflow

  if (!isOpen) {
    flip.classList.add('open');
    book.classList.add('open');
    btn.textContent = 'Chiudi Libro ðŸ“•';
  } else {
    flip.classList.add('close');
    book.classList.add('close');
    btn.textContent = 'Apri Libro ðŸ“–';
  }
  isOpen = !isOpen;
});
</script>

</body>
</html>
